# 動作環境
- PHP:8.0
- composer:2.0.8
- CakePHP:4.4.11

# プロジェクトの作成
以下のコマンドを実行
```
composer create-project --prefer-dist cakephp/app:~4.0 my_app_name
```

# 初期設定
1. .envファイルの設定
    - APP_NAME, LOCAL, TIMEZONEを設定
2. DBの設定
    - app_local.phpにdriverとdatabaseを追加
3. サーバーの起動
```
bin/cake server
```
4. migrationファイルの作成
以下のコマンドでmigrationを実行できる。
```
// テーブルの作成
bin/cake bake migrations CreatePosts

// migrationファイルの実行
bin/cake migrations migrate

// rollback
bin/cake migrations rollback

// seederファイルの作成
bin/cake bake seed Posts

// seederファイルの実行
bin/cake migrations seed
```

5. DBの確認は以下のコマンドを実行する。
```
sqlite3 database/product.sqlite
select * from posts;
```
# Modelの作成
```
bin/cake bake model posts
```

# Controllerの作成（prefixあり）
- 編集・削除などのアクションも併せて作成される。`src/Controller/Admin`の中にフォルダを作成。
```
bin/cake bake controller posts --prefix admin
```

# Viewの作成（prefixあり）
- `templates/Admin`の中にフォルダを作成。
```
bin/cake bake template posts --prefix admin
```

# 認証
## 認証プラグインのインストール
- 公式ドキュメント：[認証](https://book.cakephp.org/4/ja/tutorials-and-examples/cms/authentication.html)
```
composer require "cakephp/authentication:^2.0"
```
### ユーザーテーブルの作成
```
bin/cake bake migration CreateUsers
```

### シーダーの作成
Postsのseederファイルをコピーして作成する。

### マイグレーション、シーダーの実行
```
bin/cake migrations migrate
bin/cake migrations seed UserSeed
```

### MVCファイルの作成
1. Modelの作成
```
bin/cake bake model users
```
2. Controlerの作成
```
bin/cake bake controller users --prefix admin
```
3. Viewの作成
```
bin/cake bake template users --prefix admin
```

# 多言語化
1. 以下のコマンドを実行する。
```
bin/cake i18n
```
その後の質問はe, Enter, Enter, n, Enterで答えた。

2. キャッシュの削除
言語ファイルのキャッシュを削除するために`tmp/cache/presistent`の中の`translations`とついているファイルをずべて削除する。

# アソシエーションの設定
アソシエーションの設定は`Table/PostsTable.php`と`Table/UsersTable.php`に追加する。

# CSRFセキュリティ対策
一般的にはトークンの発行などで対策するが、CakePHPではミドルウェアを使用する。
CakePHP4ではデフォルトで設定されている。
手動でつける場合
```
<form action="">
    <input name="csrf_Token" value="<?= $this->request->getAttribute('csrfToken') ?>"</input>
</form>
```